(self.webpackChunk=self.webpackChunk||[]).push([[5099],{9848:(e,n,t)=>{"use strict";t.d(n,{Zo:()=>d,kt:()=>u});var a=t(7689);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=a.createContext({}),l=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},d=function(e){var n=l(e.components);return a.createElement(p.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,p=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),c=l(t),u=o,k=c["".concat(p,".").concat(u)]||c[u]||m[u]||i;return t?a.createElement(k,s(s({ref:n},d),{},{components:t})):a.createElement(k,s({ref:n},d))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,s=new Array(i);s[0]=c;var r={};for(var p in n)hasOwnProperty.call(n,p)&&(r[p]=n[p]);r.originalType=e,r.mdxType="string"==typeof e?e:o,s[1]=r;for(var l=2;l<i;l++)s[l]=t[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},8016:(e,n,t)=>{"use strict";t.r(n),t.d(n,{frontMatter:()=>r,contentTitle:()=>p,metadata:()=>l,toc:()=>d,default:()=>c});var a=t(2791),o=t(9698),i=(t(7689),t(9848)),s=["components"],r={id:"faq",title:"Perguntas frequentes"},p=void 0,l={unversionedId:"faq",id:"faq",isDocsHomePage:!1,title:"Perguntas frequentes",description:"Por que minha pasta node_modules usa espa\xe7o se os pacotes s\xe3o armazenados globalmente?",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/faq.md",sourceDirName:".",slug:"/faq",permalink:"/pt/next/faq",editUrl:"https://crowdin.com/project/pnpm/pt",version:"current",frontMatter:{id:"faq",title:"Perguntas frequentes"}},d=[{value:"Por que minha pasta <code>node_modules</code> usa espa\xe7o se os pacotes s\xe3o armazenados globalmente?",id:"por-que-minha-pasta-node_modules-usa-espa\xe7o-se-os-pacotes-s\xe3o-armazenados-globalmente",children:[]},{value:"Ele funciona no Windows?",id:"ele-funciona-no-windows",children:[]},{value:"Mas a abordagem aninhada do <code>node_modules</code> \xe9 incompat\xedvel com Windows?",id:"mas-a-abordagem-aninhada-do-node_modules-\xe9-incompat\xedvel-com-windows",children:[]},{value:"E quanto aos links simb\xf3licos circulares?",id:"e-quanto-aos-links-simb\xf3licos-circulares",children:[]},{value:"Por que usar hard links? Por que n\xe3o criar um link simb\xf3lico direto para o armazenamento global?",id:"por-que-usar-hard-links-por-que-n\xe3o-criar-um-link-simb\xf3lico-direto-para-o-armazenamento-global",children:[]},{value:"Does pnpm work across multiple drives or filesystems?",id:"does-pnpm-work-across-multiple-drives-or-filesystems",children:[{value:"Store path is specified",id:"store-path-is-specified",children:[]},{value:"Store path is NOT specified",id:"store-path-is-not-specified",children:[]}]},{value:"What does <code>pnpm store prune</code> do? Is it harmful?",id:"what-does-pnpm-store-prune-do-is-it-harmful",children:[]},{value:"What does <code>pnpm</code> stand for?",id:"what-does-pnpm-stand-for",children:[]},{value:"<code>pnpm</code> does not work with &lt;YOUR-PROJECT-HERE&gt;?",id:"pnpm-does-not-work-with-your-project-here",children:[{value:"Solution 1",id:"solution-1",children:[]},{value:"Solution 2",id:"solution-2",children:[]},{value:"Solution 3",id:"solution-3",children:[]}]}],m={toc:d};function c(e){var n=e.components,t=(0,o.Z)(e,s);return(0,i.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"por-que-minha-pasta-node_modules-usa-espa\xe7o-se-os-pacotes-s\xe3o-armazenados-globalmente"},"Por que minha pasta ",(0,i.kt)("inlineCode",{parentName:"h2"},"node_modules")," usa espa\xe7o se os pacotes s\xe3o armazenados globalmente?"),(0,i.kt)("p",null,"pnpm cria ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Hard_link"},"hard links")," do armazenamento global para a pasta ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," de cada projeto. Hard links apontam para o mesmo espa\xe7o no disco onde os arquivos originais est\xe3o. Ent\xe3o, por exemplo, se voc\xea tem o pacote ",(0,i.kt)("inlineCode",{parentName:"p"},"foo")," em seu projeto como uma depend\xeancia, e ocupa 1MB de espa\xe7o, ent\xe3o ir\xe1 parecer que ocupa 1MB de espa\xe7o na pasta ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules"),", e 1MB de espa\xe7o no armazenamento global. No entanto, esse 1MB \xe9 ",(0,i.kt)("em",{parentName:"p"},"o mesmo espa\xe7o")," no disco, apontado de duas localiza\xe7\xf5es diferentes. Ent\xe3o, no total, ",(0,i.kt)("inlineCode",{parentName:"p"},"foo")," ocupa 1MB, n\xe3o 2MB."),(0,i.kt)("p",null,"Para mais sobre este assunto:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://unix.stackexchange.com/questions/88423/why-do-hard-links-seem-to-take-the-same-space-as-the-originals"},"Porque os hard links parecem ocupar o mesmo espa\xe7o que os originais?")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://gist.github.com/zkochan/106cfef49f8476b753a9cbbf9c65aff1"},"Uma thread da sala de bate-papo do pnpm")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/pnpm/pnpm/issues/794"},"Uma issue no reposit\xf3rio do pnpm"))),(0,i.kt)("h2",{id:"ele-funciona-no-windows"},"Ele funciona no Windows?"),(0,i.kt)("p",null,"Resposta curta: Sim Resposta longa: Utilizar links simb\xf3licos no Windows \xe9 no m\xednimo problem\xe1tico, mas pnpm tem uma alternativa. Para Windows, n\xf3s usamos ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/windows/win32/fileio/hard-links-and-junctions"},"jun\xe7\xf5es")," em vez disso."),(0,i.kt)("h2",{id:"mas-a-abordagem-aninhada-do-node_modules-\xe9-incompat\xedvel-com-windows"},"Mas a abordagem aninhada do ",(0,i.kt)("inlineCode",{parentName:"h2"},"node_modules")," \xe9 incompat\xedvel com Windows?"),(0,i.kt)("p",null,"As primeiras vers\xf5es do npm apresentavam problemas devido ao aninhamento de todos os ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," (veja ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/nodejs/node-v0.x-archive/issues/6960"},"essa issue"),"). No entanto, pnpm n\xe3o cria pastas profundas, ele armazena todos os pacotes de forma plana e utiliza links simb\xf3licos para criar a estrutura de depend\xeancias."),(0,i.kt)("h2",{id:"e-quanto-aos-links-simb\xf3licos-circulares"},"E quanto aos links simb\xf3licos circulares?"),(0,i.kt)("p",null,"Embora o pnpm use links para colocar depend\xeancias dentro das pastas ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules"),", symlinks circulares s\xe3o evitados porque os pacotes-pai s\xe3o colocados na mesma pasta ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," em que est\xe3o suas depend\xeancias. Portanto, as depend\xeancias de ",(0,i.kt)("inlineCode",{parentName:"p"},"foo")," n\xe3o est\xe3o em ",(0,i.kt)("inlineCode",{parentName:"p"},"foo/node_modules"),", mas ",(0,i.kt)("inlineCode",{parentName:"p"},"foo")," est\xe1 em ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules"),", junto com suas pr\xf3prias depend\xeancias."),(0,i.kt)("h2",{id:"por-que-usar-hard-links-por-que-n\xe3o-criar-um-link-simb\xf3lico-direto-para-o-armazenamento-global"},"Por que usar hard links? Por que n\xe3o criar um link simb\xf3lico direto para o armazenamento global?"),(0,i.kt)("p",null,"Um pacote pode ter diferentes conjuntos de depend\xeancias numa mesma m\xe1quina."),(0,i.kt)("p",null,"No projeto ",(0,i.kt)("strong",{parentName:"p"},"A"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," pode depender de ",(0,i.kt)("inlineCode",{parentName:"p"},"bar@1.0.0"),", mas no projeto ",(0,i.kt)("strong",{parentName:"p"},"B"),", a mesma dependencia ",(0,i.kt)("inlineCode",{parentName:"p"},"foo")," pode depender de ",(0,i.kt)("inlineCode",{parentName:"p"},"bar@1.1.0"),"; ent\xe3o, pnpm liga ",(0,i.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," para todos os projetos que o usam, a fim de criar diferentes conjuntos de depend\xeancias em cada um deles."),(0,i.kt)("p",null,"Direct symlinking to the global store would work with Node's ",(0,i.kt)("inlineCode",{parentName:"p"},"--preserve-symlinks")," flag, however, that approach comes with a plethora of its own issues, so we decided to stick with hard links. For more details about why this decision was made, see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/nodejs/node-eps/issues/46"},"this issue"),"."),(0,i.kt)("h2",{id:"does-pnpm-work-across-multiple-drives-or-filesystems"},"Does pnpm work across multiple drives or filesystems?"),(0,i.kt)("p",null,"The package store should be on the same drive and filesystem as installations, otherwise packages will be copied, not linked. This is due to a limitation in how hard linking works, in that a file on one filesystem cannot address a location in another. See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/pnpm/pnpm/issues/712"},"Issue #712")," for more details."),(0,i.kt)("p",null,"pnpm functions differently in the 2 cases below:"),(0,i.kt)("h3",{id:"store-path-is-specified"},"Store path is specified"),(0,i.kt)("p",null,"If the store path is specified via ",(0,i.kt)("a",{parentName:"p",href:"/pt/next/configuring"},"the store config"),", then copying occurs between the store and any projects that are on a different disk."),(0,i.kt)("p",null,"If you run ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm install")," on disk ",(0,i.kt)("inlineCode",{parentName:"p"},"A"),", then the pnpm store must be on disk ",(0,i.kt)("inlineCode",{parentName:"p"},"A"),". If the pnpm store is located on disk ",(0,i.kt)("inlineCode",{parentName:"p"},"B"),", then all required packages will be directly copied to the project location instead of being linked. This severely inhibits the storage and performance benefits of pnpm."),(0,i.kt)("h3",{id:"store-path-is-not-specified"},"Store path is NOT specified"),(0,i.kt)("p",null,"If the store path is not set, then multiple stores are created (one per drive or filesystem)."),(0,i.kt)("p",null,"If installation is run on disk ",(0,i.kt)("inlineCode",{parentName:"p"},"A"),", the store will be created on ",(0,i.kt)("inlineCode",{parentName:"p"},"A")," ",(0,i.kt)("inlineCode",{parentName:"p"},".pnpm-store")," under the filesystem root.  If later the installation is run on disk ",(0,i.kt)("inlineCode",{parentName:"p"},"B"),", an independent store will be created on ",(0,i.kt)("inlineCode",{parentName:"p"},"B")," at ",(0,i.kt)("inlineCode",{parentName:"p"},".pnpm-store"),". The projects would still maintain the benefits of pnpm, but each drive may have redundant packages."),(0,i.kt)("h2",{id:"what-does-pnpm-store-prune-do-is-it-harmful"},"What does ",(0,i.kt)("inlineCode",{parentName:"h2"},"pnpm store prune")," do? Is it harmful?"),(0,i.kt)("p",null,"The command ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm store prune")," removes ",(0,i.kt)("em",{parentName:"p"},"unreferenced packages"),"."),(0,i.kt)("p",null,"Unreferenced packages are packages that are not used by any projects on the system. Packages can become unreferenced after most installation operations, for instance when dependencies are made redundant."),(0,i.kt)("p",null,"For example, during ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm install"),", package ",(0,i.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," is updated to ",(0,i.kt)("inlineCode",{parentName:"p"},"foo@1.0.1"),". pnpm will keep ",(0,i.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," in the store, as it does not automatically remove packages. If package ",(0,i.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," is not used by any other project on the system, it becomes unreferenced. Running ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm store prune")," would remove ",(0,i.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," from the store."),(0,i.kt)("p",null,"Running ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm store prune")," is not harmful and has no side effects on your projects. If future installations require removed packages, pnpm will download them again."),(0,i.kt)("p",null,"It is best practice to run ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm store prune")," occasionally to clean up the store, but not too frequently. Sometimes, unreferenced packages become required again. This could occur when switching branches and installing older dependencies, in which case pnpm would need to re-download all removed packages, briefly slowing down the installation process."),(0,i.kt)("h2",{id:"what-does-pnpm-stand-for"},"What does ",(0,i.kt)("inlineCode",{parentName:"h2"},"pnpm")," stand for?"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"pnpm")," stands for ",(0,i.kt)("inlineCode",{parentName:"p"},"performant npm"),". ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/rstacruz/"},"Rico Sta. Cruz")," came up with the name."),(0,i.kt)("h2",{id:"pnpm-does-not-work-with-your-project-here"},(0,i.kt)("inlineCode",{parentName:"h2"},"pnpm")," does not work with ","<","YOUR-PROJECT-HERE>?"),(0,i.kt)("p",null,"In most cases it means that one of the dependencies require packages not declared in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),". It is a common mistake caused by flat ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules"),". If this happens, this is an error in the dependency and the dependency should be fixed. That might take time though, so pnpm supports workarounds to make the buggy packages work."),(0,i.kt)("h3",{id:"solution-1"},"Solution 1"),(0,i.kt)("p",null,"In the following example, a dependency does ",(0,i.kt)("strong",{parentName:"p"},"not")," have the ",(0,i.kt)("inlineCode",{parentName:"p"},"iterall")," module in its own list of deps."),(0,i.kt)("p",null,"The easiest solution to resolve missing dependencies of the buggy packages is to ",(0,i.kt)("strong",{parentName:"p"},"add ",(0,i.kt)("inlineCode",{parentName:"strong"},"iterall")," as a dependency to our project's ",(0,i.kt)("inlineCode",{parentName:"strong"},"package.json")),"."),(0,i.kt)("p",null,"You can do so, by installing it via ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm add iterall"),", and will be automatically added to your project's ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'  "dependencies": {\n    ...\n    "iterall": "^1.2.2",\n    ...\n  }\n')),(0,i.kt)("h3",{id:"solution-2"},"Solution 2"),(0,i.kt)("p",null,"One of the solutions is to use ",(0,i.kt)("a",{parentName:"p",href:"/pt/next/pnpmfile#hooks"},"hooks")," for adding the missing dependencies to the package's ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),"."),(0,i.kt)("p",null,"An example was ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/pnpm/pnpm/issues/1043"},"Webpack Dashboard")," which wasn't working with ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm"),". It has since been resolved such that it works with ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm")," now."),(0,i.kt)("p",null,"It used to throw an error:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"Error: Cannot find module 'babel-traverse'\n  at /node_modules/inspectpack@2.2.3/node_modules/inspectpack/lib/actions/parse\n")),(0,i.kt)("p",null,"The problem was that ",(0,i.kt)("inlineCode",{parentName:"p"},"babel-traverse")," was used in ",(0,i.kt)("inlineCode",{parentName:"p"},"inspectpack")," which was used by ",(0,i.kt)("inlineCode",{parentName:"p"},"webpack-dashboard"),", but ",(0,i.kt)("inlineCode",{parentName:"p"},"babel-traverse")," wasn't specified in ",(0,i.kt)("inlineCode",{parentName:"p"},"inspectpack"),"'s ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),". It still worked with ",(0,i.kt)("inlineCode",{parentName:"p"},"npm")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn")," because they create flat ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules"),"."),(0,i.kt)("p",null,"The solution was to create a ",(0,i.kt)("inlineCode",{parentName:"p"},".pnpmfile.cjs")," with the following contents:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  hooks: {\n    readPackage: (pkg) => {\n      if (pkg.name === \"inspectpack\") {\n        pkg.dependencies['babel-traverse'] = '^6.26.0';\n      }\n      return pkg;\n    }\n  }\n};\n")),(0,i.kt)("p",null,"After creating a ",(0,i.kt)("inlineCode",{parentName:"p"},".pnpmfile.cjs"),", delete ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm-lock.yaml")," only - there is no need to delete ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules"),", as pnpm hooks only effect module resolution. Then, rebuild the dependencies & it should be working."),(0,i.kt)("h3",{id:"solution-3"},"Solution 3"),(0,i.kt)("p",null,"In case there are too many issues, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"shamefully-hoist")," option. This creates a flat ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," structure similar to the one created by ",(0,i.kt)("inlineCode",{parentName:"p"},"npm")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn"),", which is not recommended as avoiding this structure is the primary purpose of pnpm's ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," approach."),(0,i.kt)("p",null,"To use it, try ",(0,i.kt)("inlineCode",{parentName:"p"},"pnpm install --shamefully-hoist"),"."))}c.isMDXComponent=!0}}]);